{"version":3,"sources":["../../src/pages/checkout-payment/checkout-payment.module.ts","../../src/components/cart-progress/cart-progress.module.ts","../../src/components/cart-progress/cart-progress.ts","../../src/pages/checkout-payment/checkout-payment.ts"],"names":[],"mappings":"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","file":"0.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { CheckoutPaymentPage } from './checkout-payment';\nimport { CartProgressModule } from '../../components/cart-progress/cart-progress.module';\n\n\n@NgModule({\n  declarations: [\n    CheckoutPaymentPage,\n  ],\n  imports: [\n    CartProgressModule,\n    IonicPageModule.forChild(CheckoutPaymentPage)\n  ],\n  entryComponents: [\n    CheckoutPaymentPage\n  ]\n})\nexport class CheckoutPaymentModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/checkout-payment/checkout-payment.module.ts","import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { CartProgress } from './cart-progress';\nimport { CommonModule } from '@angular/common';\n\n\n@NgModule({\n  declarations: [\n    CartProgress,\n  ],\n  imports: [\n    CommonModule\n  ],\n  exports: [\n    CartProgress\n  ]\n})\nexport class CartProgressModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/cart-progress/cart-progress.module.ts","import { Component, Input, NgModule } from '@angular/core';\nimport { Button, Select } from 'ionic-angular';\n \n@Component({\n    selector: 'cart-progress',\n    templateUrl: 'cart-progress.html'\n})\nexport class CartProgress {\n\n    @Input('amount') amount: number;\n    @Input('current') current: number;\n\n    private elements: string[] = [\n        \"Details\",\n        \"Payment\",\n        \"Confirm\"\n    ]\n\n    getElements(): Array<number> {\n        return Array.from({length: this.amount}, (x,i) => i + 1);\n    }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/components/cart-progress/cart-progress.ts","import {\n    Component\n} from \"@angular/core\";\nimport {\n    IonicPage,\n    ModalController,\n    NavController,\n    NavParams\n} from \"ionic-angular\";\nimport {\n    MoltinCart\n} from \"../../providers/moltin/models/cart\";\nimport { Moltin } from \"../../providers/moltin/moltin\";\n\ndeclare var Stripe: any;\n\n@IonicPage({\n    name: \"checkout-payment\",\n    segment: \"checkout-payment\"\n})\n@Component({\n    selector: \"page-checkout-payment\",\n    templateUrl: \"checkout-payment.html\"\n})\nexport class CheckoutPaymentPage {\n\n    private stripe = Stripe('pk_test_jpI6XzhcNeNPSGxicVyDJd2w');\n    private paymentRequest: any;\n    private card: any;\n    private canMakePayment: boolean = true;\n    private moltinCart: MoltinCart = this.navParams.get('cart');\n    private customer: {} = this.navParams.get('customer');\n\n    private selectedPaymentMethod: string = \"apple-pay\";\n    private formIsValid: boolean = false;\n\n    private promoCode: string;\n\n    constructor(\n        private navController: NavController,\n        private navParams: NavParams,\n        private moltin: Moltin\n    ) {\n        this.constructPaymentRequest();\n    }\n\n    ionViewDidLoad() {\n        this.mountPaymentButton();\n        this.constructPaymentForm();\n    }\n\n    constructPaymentRequest() {\n        let items = this.moltinCart.data.map(item => {\n            return {\n                \"amount\": item.meta.display_price.with_tax.value.amount,\n                \"label\": item.name\n            }\n        })\n        this.paymentRequest = this.stripe.paymentRequest({\n            country: 'US',\n            currency: this.moltinCart.meta.display_price.with_tax.currency.toLowerCase(),\n            total: {\n                label: 'Total Payment',\n                amount: this.moltinCart.meta.display_price.with_tax.amount,\n            },\n            requestPayerName: true,\n            requestPayerEmail: true,\n            displayItems: items\n        });\n\n        this.paymentRequest.on('token', (ev) => {\n            ev.complete('success');\n            this.moveToConfirmationPage(ev.token);\n        });\n\n        this.paymentRequest.on('error', (ev) => {\n            console.log(ev);\n        });\n\n        this.paymentRequest.on('cancel', (ev) => {\n            console.log(ev);\n        })\n    }\n\n    mountPaymentButton() {\n        const elements = this.stripe.elements();\n        const prButton = elements.create('paymentRequestButton', {\n            \"paymentRequest\": this.paymentRequest,\n            style: {\n                paymentRequestButton: {\n                    theme: 'light-outline',\n                    height: '44px',\n                },\n            },\n        });\n\n        (async () => {\n            // Check the availability of the Payment Request API first.\n            const result = await this.paymentRequest.canMakePayment();\n            if (result) {\n                prButton.mount('#payment-request-button');\n            } else {\n                this.canMakePayment = false;\n                this.selectedPaymentMethod = \"card\";\n            }\n        })();\n    }\n\n    constructPaymentForm() {\n        this.card = this.stripe.elements().create('card', {\n            hidePostalCode: true\n        });\n        this.card.mount(\"#card-element\");\n\n        this.card.on('change', (ev) => {\n            this.formIsValid = ev.complete;\n        });\n    }\n\n    applyPromoCode() {\n        this.moltin.applyPromoCode(this.promoCode).subscribe(\n            data => console.log(data),\n            error => console.error(error)\n        )\n    }\n\n    confirmOrder() {\n        if (this.selectedPaymentMethod == \"card\") {\n            this.stripe.createToken(this.card).then((result) => {\n                if (result.error) {\n                    console.error(result.error);\n                } else {\n                    this.moveToConfirmationPage(result.token);\n                }\n            });\n        }\n    }\n\n    moveToConfirmationPage(token) {\n        this.navController.push('checkout-confirmation', {\n            'customer': this.customer,\n            'token': token\n        });\n    }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/pages/checkout-payment/checkout-payment.ts"],"sourceRoot":""}